!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){(function(e){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(8),a=function(t){function n(){r(this,n);var e=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.controller.subscribe("settings",e._onSettings.bind(e)),e.controller.subscribe("slackInfo",e._onSlackInfo.bind(e)),window.addEventListener("load",e.formHandler.bind(e)),e._showSlackAuthUI=e._showSlackAuthUI.bind(e),e._slackInfo=!1,e._settings=null,e}return i(n,t),u(n,[{key:"_showSlackAuthUI",value:function(){e.log("_showSlackAuthUI called");var t="showSlackAuth",n={};this._proxy.postMessage({method:"notifyClient",params:{topic:t,value:n}},"*")}},{key:"presentView",value:function(t){e.log("scrumbot-sift: presentView: ",t),this.showOAuthPopup({provider:"google",options:{refreshToken:!0}});var n=t.data,r=n.slackInfo,o=n.settings;this._slackInfo=r,this._settings=o,this.setupUI({slackInfo:r,settings:o})}},{key:"formHandler",value:function(){var e=this;document.querySelector("#settings-form").addEventListener("submit",function(t){t.preventDefault();var n=document.forms[0],r=n["start-of-day"].value,o=n["meeting-call"].value;parseInt(o)<parseInt(r)?alert("Meeting call time must be the same as or after start of day"):e.publish("wpm",{tz:n.tz.value,startOfDay:r,meetingCall:o})})}},{key:"willPresentView",value:function(t){e.log("scrumbot: willPresentView: ",t)}},{key:"setupUI",value:function(t){var n=this,r=t.slackInfo,o=t.settings;e.log("scrumbot: setupUI: ",r,o),r&&o?($("select[name=tz]").val(o.tz),$(".selectpicker").selectpicker("refresh"),$("select[name=start-of-day]").val(o.startOfDay),$(".selectpicker").selectpicker("refresh"),$("select[name=meeting-call").val(o.meetingCall),$(".selectpicker").selectpicker("refresh"),$("#configured").css("display","block"),$("#notConfigured").css("display","none")):(document.querySelector("#signupBtn").addEventListener("click",function(t){e.log("clicked connect button"),n._showSlackAuthUI()}),$("#configured").css("display","none"),$("#notConfigured").css("display","flex"))}},{key:"_onSettings",value:function(t){e.log("scrumbot: _onSettings view: ",t),this._settings=t,this.setupUI({slackInfo:this._slackInfo,settings:t})}},{key:"_onSlackInfo",value:function(t){e.log("scrumbot: _onSlackInfo view: ",t),this._slackInfo=t,this.setupUI({slackInfo:t,settings:this._settings})}}]),n}(s.SiftView);t.default=a,(0,s.registerSiftView)(new a(window))}).call(t,n(1))},function(e,t,n){(function(t){function r(){}function o(){p.log.apply(p,arguments)}function i(){p.log.apply(p,arguments)}function u(){p.warn.apply(p,arguments)}function s(e){v[e]=g()}function a(e){var t=v[e];if(!t)throw new Error("No such label: "+e);var n=g()-t;p.log(e+": "+n+"ms")}function c(){var e=new Error;e.name="Trace",e.message=d.format.apply(null,arguments),p.error(e.stack)}function l(e){p.log(d.inspect(e)+"\n")}function f(e){if(!e){var t=y.call(arguments,1);h.ok(!1,d.format.apply(null,t))}}var p,d=n(2),h=n(6),g=n(7),y=Array.prototype.slice,v={};p="undefined"!=typeof t&&t.console?t.console:"undefined"!=typeof window&&window.console?window.console:{};for(var b=[[r,"log"],[o,"info"],[i,"warn"],[u,"error"],[s,"time"],[a,"timeEnd"],[c,"trace"],[l,"dir"],[f,"assert"]],m=0;m<b.length;m++){var k=b[m],w=k[0],_=k[1];p[_]||(p[_]=w)}e.exports=p}).call(t,function(){return this}())},function(e,t,n){(function(e,r,o){function i(e,n){var r={seen:[],stylize:s};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),y(n)?r.showHidden=n:n&&t._extend(r,n),_(r.showHidden)&&(r.showHidden=!1),_(r.depth)&&(r.depth=2),_(r.colors)&&(r.colors=!1),_(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=u),c(r,e,r.depth)}function u(e,t){var n=i.styles[t];return n?"["+i.colors[n][0]+"m"+e+"["+i.colors[n][1]+"m":e}function s(e,t){return e}function a(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function c(e,n,r){if(e.customInspect&&n&&O(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var o=n.inspect(r,e);return k(o)||(o=c(e,o,r)),o}var i=l(e,n);if(i)return i;var u=Object.keys(n),s=a(u);if(e.showHidden&&(u=Object.getOwnPropertyNames(n)),I(n)&&(u.indexOf("message")>=0||u.indexOf("description")>=0))return f(n);if(0===u.length){if(O(n)){var y=n.name?": "+n.name:"";return e.stylize("[Function"+y+"]","special")}if(x(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(E(n))return e.stylize(Date.prototype.toString.call(n),"date");if(I(n))return f(n)}var v="",b=!1,m=["{","}"];if(g(n)&&(b=!0,m=["[","]"]),O(n)){var w=n.name?": "+n.name:"";v=" [Function"+w+"]"}if(x(n)&&(v=" "+RegExp.prototype.toString.call(n)),E(n)&&(v=" "+Date.prototype.toUTCString.call(n)),I(n)&&(v=" "+f(n)),0===u.length&&(!b||0==n.length))return m[0]+v+m[1];if(r<0)return x(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special");e.seen.push(n);var _;return _=b?p(e,n,r,s,u):u.map(function(t){return d(e,n,r,s,t,b)}),e.seen.pop(),h(_,v,m)}function l(e,t){if(_(t))return e.stylize("undefined","undefined");if(k(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return m(t)?e.stylize(""+t,"number"):y(t)?e.stylize(""+t,"boolean"):v(t)?e.stylize("null","null"):void 0}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,n,r,o){for(var i=[],u=0,s=t.length;u<s;++u)A(t,String(u))?i.push(d(e,t,n,r,String(u),!0)):i.push("");return o.forEach(function(o){o.match(/^\d+$/)||i.push(d(e,t,n,r,o,!0))}),i}function d(e,t,n,r,o,i){var u,s,a;if(a=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]},a.get?s=a.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):a.set&&(s=e.stylize("[Setter]","special")),A(r,o)||(u="["+o+"]"),s||(e.seen.indexOf(a.value)<0?(s=v(n)?c(e,a.value,null):c(e,a.value,n-1),s.indexOf("\n")>-1&&(s=i?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n"))):s=e.stylize("[Circular]","special")),_(u)){if(i&&o.match(/^\d+$/))return s;u=JSON.stringify(""+o),u.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(u=u.substr(1,u.length-2),u=e.stylize(u,"name")):(u=u.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),u=e.stylize(u,"string"))}return u+": "+s}function h(e,t,n){var r=0,o=e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return o>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function g(e){return Array.isArray(e)}function y(e){return"boolean"==typeof e}function v(e){return null===e}function b(e){return null==e}function m(e){return"number"==typeof e}function k(e){return"string"==typeof e}function w(e){return"symbol"==typeof e}function _(e){return void 0===e}function x(e){return S(e)&&"[object RegExp]"===T(e)}function S(e){return"object"==typeof e&&null!==e}function E(e){return S(e)&&"[object Date]"===T(e)}function I(e){return S(e)&&("[object Error]"===T(e)||e instanceof Error)}function O(e){return"function"==typeof e}function j(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function T(e){return Object.prototype.toString.call(e)}function C(e){return e<10?"0"+e.toString(10):e.toString(10)}function P(){var e=new Date,t=[C(e.getHours()),C(e.getMinutes()),C(e.getSeconds())].join(":");return[e.getDate(),U[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var D=/%[sdj%]/g;t.format=function(e){if(!k(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(i(arguments[n]));return t.join(" ")}for(var n=1,r=arguments,o=r.length,u=String(e).replace(D,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),s=r[n];n<o;s=r[++n])u+=v(s)||!S(s)?" "+s:" "+i(s);return u},t.deprecate=function(n,i){function u(){if(!s){if(r.throwDeprecation)throw new Error(i);r.traceDeprecation?o.trace(i):o.error(i),s=!0}return n.apply(this,arguments)}if(_(e.process))return function(){return t.deprecate(n,i).apply(this,arguments)};if(r.noDeprecation===!0)return n;var s=!1;return u};var q,G={};t.debuglog=function(e){if(_(q)&&(q=r.env.NODE_DEBUG||""),e=e.toUpperCase(),!G[e])if(new RegExp("\\b"+e+"\\b","i").test(q)){var n=r.pid;G[e]=function(){var r=t.format.apply(t,arguments);o.error("%s %d: %s",e,n,r)}}else G[e]=function(){};return G[e]},t.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=g,t.isBoolean=y,t.isNull=v,t.isNullOrUndefined=b,t.isNumber=m,t.isString=k,t.isSymbol=w,t.isUndefined=_,t.isRegExp=x,t.isObject=S,t.isDate=E,t.isError=I,t.isFunction=O,t.isPrimitive=j,t.isBuffer=n(4);var U=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];t.log=function(){o.log("%s - %s",P(),t.format.apply(t,arguments))},t.inherits=n(5),t._extend=function(e,t){if(!t||!S(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(t,function(){return this}(),n(3),n(1))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function i(e){if(f===clearTimeout)return clearTimeout(e);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function u(){g&&d&&(g=!1,d.length?h=d.concat(h):y=-1,h.length&&s())}function s(){if(!g){var e=o(u);g=!0;for(var t=h.length;t;){for(d=h,h=[];++y<t;)d&&d[y].run();y=-1,t=h.length}d=null,g=!1,i(e)}}function a(e,t){this.fun=e,this.array=t}function c(){}var l,f,p=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(e){f=r}}();var d,h=[],g=!1,y=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new a(e,t)),1!==h.length||g||o(s)},a.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.prependListener=c,p.prependOnceListener=c,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){(function(t){"use strict";/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */
function r(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,o=0,i=Math.min(n,r);o<i;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0}function o(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}function i(e){return Object.prototype.toString.call(e)}function u(e){return!o(e)&&("function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}function s(e){if(k.isFunction(e)){if(x)return e.name;var t=e.toString(),n=t.match(E);return n&&n[1]}}function a(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function c(e){if(x||!k.isFunction(e))return k.inspect(e);var t=s(e),n=t?": "+t:"";return"[Function"+n+"]"}function l(e){return a(c(e.actual),128)+" "+e.operator+" "+a(c(e.expected),128)}function f(e,t,n,r,o){throw new S.AssertionError({message:n,actual:e,expected:t,operator:r,stackStartFunction:o})}function p(e,t){e||f(e,!0,t,"==",S.ok)}function d(e,t,n,s){if(e===t)return!0;if(o(e)&&o(t))return 0===r(e,t);if(k.isDate(e)&&k.isDate(t))return e.getTime()===t.getTime();if(k.isRegExp(e)&&k.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(u(e)&&u(t)&&i(e)===i(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===r(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(o(e)!==o(t))return!1;s=s||{actual:[],expected:[]};var a=s.actual.indexOf(e);return a!==-1&&a===s.expected.indexOf(t)||(s.actual.push(e),s.expected.push(t),g(e,t,n,s))}return n?e===t:e==t}function h(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function g(e,t,n,r){if(null===e||void 0===e||null===t||void 0===t)return!1;if(k.isPrimitive(e)||k.isPrimitive(t))return e===t;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var o=h(e),i=h(t);if(o&&!i||!o&&i)return!1;if(o)return e=_.call(e),t=_.call(t),d(e,t,n);var u,s,a=I(e),c=I(t);if(a.length!==c.length)return!1;for(a.sort(),c.sort(),s=a.length-1;s>=0;s--)if(a[s]!==c[s])return!1;for(s=a.length-1;s>=0;s--)if(u=a[s],!d(e[u],t[u],n,r))return!1;return!0}function y(e,t,n){d(e,t,!0)&&f(e,t,n,"notDeepStrictEqual",y)}function v(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&t.call({},e)===!0}function b(e){var t;try{e()}catch(e){t=e}return t}function m(e,t,n,r){var o;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(r=n,n=null),o=b(t),r=(n&&n.name?" ("+n.name+").":".")+(r?" "+r:"."),e&&!o&&f(o,n,"Missing expected exception"+r);var i="string"==typeof r,u=!e&&k.isError(o),s=!e&&o&&!n;if((u&&i&&v(o,n)||s)&&f(o,n,"Got unwanted exception"+r),e&&o&&n&&!v(o,n)||!e&&o)throw o}var k=n(2),w=Object.prototype.hasOwnProperty,_=Array.prototype.slice,x=function(){return"foo"===function(){}.name}(),S=e.exports=p,E=/\s*function\s+([^\(\s]*)\s*/;S.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=l(this),this.generatedMessage=!0);var t=e.stackStartFunction||f;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var r=n.stack,o=s(t),i=r.indexOf("\n"+o);if(i>=0){var u=r.indexOf("\n",i+1);r=r.substring(u+1)}this.stack=r}}},k.inherits(S.AssertionError,Error),S.fail=f,S.ok=p,S.equal=function(e,t,n){e!=t&&f(e,t,n,"==",S.equal)},S.notEqual=function(e,t,n){e==t&&f(e,t,n,"!=",S.notEqual)},S.deepEqual=function(e,t,n){d(e,t,!1)||f(e,t,n,"deepEqual",S.deepEqual)},S.deepStrictEqual=function(e,t,n){d(e,t,!0)||f(e,t,n,"deepStrictEqual",S.deepStrictEqual)},S.notDeepEqual=function(e,t,n){d(e,t,!1)&&f(e,t,n,"notDeepEqual",S.notDeepEqual)},S.notDeepStrictEqual=y,S.strictEqual=function(e,t,n){e!==t&&f(e,t,n,"===",S.strictEqual)},S.notStrictEqual=function(e,t,n){e===t&&f(e,t,n,"!==",S.notStrictEqual)},S.throws=function(e,t,n){m(!0,e,t,n)},S.doesNotThrow=function(e,t,n){m(!1,e,t,n)},S.ifError=function(e){if(e)throw e};var I=Object.keys||function(e){var t=[];for(var n in e)w.call(e,n)&&t.push(n);return t}}).call(t,function(){return this}())},function(e,t){function n(){return(new Date).getTime()}e.exports=n},function(e,t,n){var r,o,i;(function(n,u){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(n,u){"object"===s(t)&&"undefined"!=typeof e?u(t):(o=[t],r=u,i="function"==typeof r?r.apply(t,o):r,!(void 0!==i&&(e.exports=i)))}(void 0,function(e){function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function r(e,t){return t={exports:{}},e(t,t.exports),t.exports}function o(e,t){this.db=null,this.name=e,this.indexes={},this.opts=t,this.key=t.key||t.keyPath||void 0,this.increment=t.increment||t.autoIncretement||void 0}function i(e,t,n,r){this.store=e,this.name=t,this.field=n,this.opts=r,this.multi=r.multi||r.multiEntry||!1,this.unique=r.unique||!1}function a(){return this instanceof a?(this._stores={},this._current={},void(this._versions={})):new a}function c(e){re.trace("[opCreateDb]: ",e);var t={};switch(e.type){case"MSG":t.msg=ne("rs_msg_db-"+e.accountGuid,_(ie));break;case"SIFT":if(!e.siftGuid)throw new Error("[opCreateDb]: dbInfo.siftGuid undefined");re.trace("[opCreateDb]: creating SIFT db");var n=w(e.schema,!0);n=n.addStore("_user.default").addStore("_redsift").addStore("_org"),t.db=ne(e.siftGuid+"-"+e.accountGuid,n),t.msg=ne("rs_msg_db-"+e.accountGuid,_(ie));break;case"SYNC":re.trace("[opCreateDb]: creating SYNC db"),t.db=ne("rs_sync_log-"+e.accountGuid,w(ue));break;case"CLIENT":t.db=ne("rs_client_db-"+e.clientName,w(se));break;default:throw new Error("[opCreateDb]: unsupported db type: "+e.type)}return t}function l(e,t,n){if(re.trace("[opCursor]",t),!t.bucket)throw new Error("[opCursor: params.bucket undefined");var r=e.store(t.bucket);r.cursor({iterator:t.iterator},n)}function f(e){return re.trace("[opDeleteDatabase]"),new Promise(function(t,n){e.drop(function(e){e?n(e):t()})})}function p(e,t,n){if(re.trace("[opDel]: ",t,n),!t.bucket)return Promise.reject("[opDel]: params.bucket undefined");if(!t.keys||0===t.keys.length)return re.trace("[opDel]: params.keys undefined"),Promise.resolve();if(oe.indexOf(t.bucket)!==-1){var r=t.keys.map(function(e){return n+"/"+e});return x(e.msg,{bucket:t.bucket,keys:r})}return x(e.db,t)}function d(e,t,n){if(re.trace("[opGet]: ",t),!t.bucket)return Promise.reject("[opGet]: params.bucket undefined");if(!t.keys)return Promise.reject("[opGet]: param.keys undefined");if(0===t.keys.length)return Promise.resolve([]);if(oe.indexOf(t.bucket)!==-1){var r=t.keys.map(function(e){return n+"/"+e});return I(e.msg,{bucket:t.bucket,keys:r}).then(function(e){return e.map(function(e){return{key:e.key.split("/")[1],value:e.value}})})}return I(e.db,t)}function h(e,t,n){return re.trace("[opGetAll]: ",t,n),t.bucket?oe.indexOf(t.bucket)!==-1?O(e.msg,{bucket:t.bucket,index:"sift.guid",range:n},!0).then(function(e){return e.map(function(e){return{key:e.key.split("/")[1],value:e.value}})}):O(e.db,t,!0):Promise.reject("[opGetAll]: params.bucket undefined")}function g(e,t,n){return re.trace("[opGetAllKeys]: ",t,n),t.bucket?oe.indexOf(t.bucket)!==-1?O(e.msg,{bucket:t.bucket,index:"sift.guid",range:n},!1).then(function(e){return e.map(function(e){return e.key.split("/")[1]})}):O(e.db,t,!1):Promise.reject("[opGetAllKeys]: params.bucket undefined")}function y(e,t,n){return re.trace("[opGetIndex]: ",t,n),t.bucket?oe.indexOf(t.bucket)!==-1?O(e.msg,{bucket:t.bucket,index:"sift.guid",range:n},!0).then(function(e){return e.map(function(e){return{key:e.key.split("/")[1],value:e.value}})}):t.index?O(e.db,t,!0):Promise.reject("[opGetIndex]:params.index undefined"):Promise.reject("[opGetIndex]:params.bucket undefined")}function v(e,t,n){return re.trace("[opGetIndexKeys]: ",t,n),t.bucket?oe.indexOf(t.bucket)!==-1?O(e.msg,{bucket:t.bucket,index:"sift.guid",range:n},!1).then(function(e){return e.map(function(e){return{key:e.key.split("/")[1],value:e.value}})}):t.index?O(e.db,t,!1):Promise.reject("[opGetIndexKeys]: params.index undefined"):Promise.reject("[opGetIndexKeys]: params.bucket undefined")}function b(e,t,n){if(re.trace("[opGetWithIndex]: ",t,n),!t.bucket)return Promise.reject("[opGetWithIndex]:params.bucket undefined");if(!t.keys)return Promise.reject("[opGetWithIndex]:params.keys undefined");if(oe.indexOf(t.bucket)!==-1){var r=t.keys.map(function(e){return n+"/"+e});return E(e.msg,{bucket:t.bucket,keys:r,index:"sift.guid",range:n}).then(function(e){return e.map(function(e){return{key:e.key.split("/")[1],value:e.value}})})}return t.index?t.range?E(e.db,t):Promise.reject("[opGetWithIndex]:params.range undefined"):Promise.reject("[opGetWithIndex]:params.index undefined")}function m(e,t,n,r){re.trace("[opPut]: ",t,n,r);var o=e.db;if(!t.bucket)return Promise.reject("[opPut]: params.bucket undefined");if(!t.kvs||0===t.kvs.length)return re.warn("[opPut]: params.kvs undefined"),Promise.resolve();var i=t.kvs;if(n||(i=i.map(function(e){return{key:e.key,value:{value:e.value}}})),oe.indexOf(t.bucket)!==-1){o=e.msg;var i=i.map(function(e){return{key:r+"/"+e.key,value:e.value}})}return S(o,{bucket:t.bucket,kvs:i},n)}function k(e,t){re.trace("[opClose]"),t||(t=function(){}),e.db.close(t)}function w(e,t){re.trace("[_getTreoSchema]: ",e,t);var n=ne.schema().version(1);return e.forEach(function(e){t&&oe.indexOf(e.name)!==-1||(n=e.keypath?n.addStore(e.name,{key:e.keypath}):n.addStore(e.name),e.indexes&&e.indexes.forEach(function(e){n=n.addIndex(e,"twoI."+e,{unique:!1})}))}),n}function _(e,t){re.trace("[_getVersionedTreoSchema]: ",e,t);var n=ne.schema();return e.forEach(function(e,r){n=n.version(r+1),e.forEach(function(e){t&&oe.indexOf(e.name)!==-1||(e.drop?(re.trace("[_getVersionedTreoSchema]: dropping store: ",e.name),n=n.dropStore(e.name)):n=e.keypath?n.addStore(e.name,{key:e.keypath}):n.addStore(e.name),e.indexes&&e.indexes.forEach(function(t){e.drop?(re.trace("[_getVersionedTreoSchema]: dropping store/index: "+e.name+"/"+t),n=n.dropIndex(t)):n=n.addIndex(t,t,{unique:!1})}))})}),n}function x(e,t){return re.trace("[_batchDelete]: ",t),new Promise(function(n,r){e.transaction("readwrite",[t.bucket],function(e,o){if(e)return r(e);var i=o.objectStore(t.bucket),u=0,s=function e(){if(!(u>=t.keys.length)){var n,o=t.keys[u];n=i.delete(o),n.onerror=r,n.onsuccess=e,u+=1}};o.onerror=o.onabort=r,o.oncomplete=function(){n()},s()})})}function S(e,t){return re.trace("[_batchPut]: ",t),new Promise(function(n,r){var o=t.kvs.length;e.transaction("readwrite",[t.bucket],function(e,i){if(e)return r(e);var u=i.objectStore(t.bucket),s=0,a=function e(){if(!(s>=o)){re.trace("[_batchPut: put: ",t.kvs[s]);var n;n=u.put(t.kvs[s].value,t.kvs[s].key),n.onerror=r,n.onsuccess=e,s+=1}};i.onerror=i.onabort=r,i.oncomplete=function(){n()},a()})})}function E(e,t){return re.trace("[_getWithIndexRange]: ",t),new Promise(function(n,r){var o=e.store(t.bucket),i=[],u=0,s=function(e){var n=t.keys.indexOf(e.primaryKey);return n!==-1&&(re.trace("[found key: ",e.primaryKey),i[n].value=e.value.value,u++),u===t.keys.length?a():void e.continue()},a=function(e){re.trace("[_getWithIndexRange: result: ",i),e?r(e):n(i)};t.keys.forEach(function(e){i.push({key:e,value:void 0})}),o.cursor({index:t.index,range:t.range,iterator:s},a)})}function I(e,t){return re.trace("[_findIn]: ",t),new Promise(function(n,r){var o=e.store(t.bucket),i=[],u=0,s=function(e){if(re.trace("[_findIn]: iterator: ",e),e.key>c[u]){for(re.trace("[_findIn]: cursor ahead: ",e.key,c[u]);e.key>c[u]&&u<c.length;)u+=1,re.trace("[_findIn]: moving to next key: ",e.key,c[u]);if(u>c.length)return re.trace("[_findIn]: exhausted keys. done."),a()}e.key===c[u]?(re.trace("[_findIn]: found key: ",e.key,e.value),i[t.keys.indexOf(c[u])]={key:e.key,value:e.value.value},u+=1,u<c.length?e.continue(c[u]):a()):(re.trace("[_findIn]: continuing to next key: ",c[u]),u<c.length?e.continue(c[u]):a())},a=function(e){re.trace("[findIn]: result: ",i),e?r(e):n(i)},c=t.keys.slice();c=c.sort(ne.cmp),re.trace("[findIn: sorted keys: ",c),t.keys.forEach(function(e){i.push({key:e,value:void 0})}),o.cursor({iterator:s},a)})}function O(e,t,n){return re.trace("[_getAll]: ",t,n),new Promise(function(r,o){var i=[],u=[],s=e.store(t.bucket),a=function(e){var r={key:e.primaryKey};re.trace("[_getAll]: cursor",e),n&&(r.value=e.value.value),t.index&&(r.index=e.key),i.push(r),u.push(e.primaryKey),e.continue()},c={iterator:a};t.index&&(c.index=t.index),t.range&&(c.range=t.range),s.cursor(c,function(e){e?o(e):t.index||t.range||n?(re.trace("[_getAll]: resolving: ",i),r(i)):(re.trace("[_getAll]: resolving: ",u),r(u))})})}function j(e){n.log("[Redsift::registerSiftView]: registered")}function T(e){return q(N,e)}function C(e){return q(ge,e)}function P(e){n.log("[Redsift::registerSiftController]: registered")}function A(e){return q(M,e)}function D(e){n.log("[Redsift::registerEmailClientController]: registered")}function q(e,t){var n=function(){e.call(this),this.init&&"function"==typeof this.init&&this.init()};return n.prototype=Object.create(e.prototype),n.constructor=n,Object.keys(t).forEach(function(e){n.prototype[e]=t[e]}),new n}var G=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},U=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),L=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},V=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t},M=function(){function e(){G(this,e),this._proxy=self,this._registerMessageListeners()}return U(e,[{key:"_registerMessageListeners",value:function(){var e=this;this._proxy&&(this._proxy.onmessage=function(t){var n=t.data.method;e["_"+n]&&e["_"+n](t.data.params)})}},{key:"_emailStats",value:function(e){this.onstats&&this.onstats(e.name,e.value)}},{key:"_getThreadRowDisplayInfo",value:function(e){var t=this,n={};e.tris.forEach(function(r){void 0!==r.value&&void 0!==r.value.list&&t.loadThreadListView&&(n[r.key]=t.loadThreadListView(r.value.list,e.supportedTemplates))}),this._proxy.postMessage({method:"getThreadRowDisplayInfoCallback",params:n})}}]),e}(),R=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},z=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),B=function(){function e(){R(this,e),this._observers=[]}return z(e,[{key:"subscribe",value:function(e,t){this._op("_sub",e,t)}},{key:"unsubscribe",value:function(e,t){this._op("_unsub",e,t)}},{key:"unsubscribeAll",value:function(e){this._observers[e]&&delete this._observers[e]}},{key:"publish",value:function(e,t){this._op("_pub",e,t)}},{key:"_op",value:function(e,t,n){var r=this;Array.isArray(t)?t.forEach(function(t){r[e](t,n)}):this[e](t,n)}},{key:"_sub",value:function(e,t){this._observers[e]||(this._observers[e]=[]),t&&this._observers[e].indexOf(t)===-1&&this._observers[e].push(t)}},{key:"_unsub",value:function(e,t){if(this._observers[e]){var n=this._observers[e].indexOf(t);~n&&this._observers[e].splice(n,1)}}},{key:"_pub",value:function(e,t){if(this._observers[e])for(var n=this._observers[e].length-1;n>=0;n--)this._observers[e][n](t)}}]),e}(),N=function(){function e(){G(this,e),this._resizeHandler=null,this._proxy=parent,this.controller=new B,this._registerMessageListeners()}return U(e,[{key:"publish",value:function(e,t){this._proxy.postMessage({method:"notifyController",params:{topic:e,value:t}},"*")}},{key:"notifyClient",value:function(e,t){this._proxy.postMessage({method:"notifyClient",params:{topic:e,value:t}},"*")}},{key:"showOAuthPopup",value:function(e){var t=e.provider,n=e.options,r=void 0===n?null:n,o="showOAuthPopup",i={provider:t,options:r};this.notifyClient(o,i)}},{key:"login",value:function(){var e="login",t={};this.notifyClient(e,t)}},{key:"logout",value:function(){var e="logout",t={};this.notifyClient(e,t)}},{key:"navigate",value:function(e){var t=e.href,n=e.openInNewTab,r=void 0!==n&&n,o="navigate",i={href:t,openInNewTab:r};this.notifyClient(o,i)}},{key:"_registerMessageListeners",value:function(){var e=this;window.addEventListener("message",function(t){var r=t.data.method,o=t.data.params;"notifyView"===r?e.controller.publish(o.topic,o.value):e[r]?e[r](o):n.warn("[SiftView]: method not implemented: ",r)},!1)}}]),e}(),K=function(e){function t(e){G(this,t);var n=V(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._proxy=e,n}return L(t,e),U(t,[{key:"goto",value:function(e){this._postMessage("goto",e)}},{key:"close",value:function(){this._postMessage("close")}},{key:"_postMessage",value:function(e,t){this._proxy.postMessage({method:"notifyClient",params:{topic:e,value:t}})}}]),t}(B),F=function(e){function t(){G(this,t);var e=V(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._storage=null,e}return L(t,e),U(t,[{key:"init",value:function(e){this._storage=e}},{key:"get",value:function(e){return this._storage.get(e)}},{key:"getIndexKeys",value:function(e){return this._storage.getIndexKeys(e)}},{key:"getIndex",value:function(e){return this._storage.getIndex(e)}},{key:"getWithIndex",value:function(e){return this._storage.getWithIndex(e)}},{key:"getAllKeys",value:function(e){return this._storage.getAllKeys(e)}},{key:"getAll",value:function(e){return this._storage.getAll(e)}},{key:"getUser",value:function(e){return this._storage.getUser(e)}},{key:"putUser",value:function(e){return this._storage.putUser(e)}},{key:"delUser",value:function(e){return this._storage.delUser(e)}}]),t}(B),W="undefined"!=typeof window?window:"undefined"!=typeof u?u:"undefined"!=typeof self?self:{},$=r(function(e){!function(t,n){e.exports?e.exports=n():t.log=n()}(W,function(){function e(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function t(t){return"debug"===t&&(t="log"),("undefined"==typeof n?"undefined":s(n))!==c&&(void 0!==n[t]?e(n,t):void 0!==n.log?e(n,"log"):a)}function r(e,t){for(var n=0;n<l.length;n++){var r=l[n];this[r]=n<e?a:this.methodFactory(r,e,t)}this.log=this.debug}function o(e,t,o){return function(){("undefined"==typeof n?"undefined":s(n))!==c&&(r.call(this,t,o),this[e].apply(this,arguments))}}function i(e,n,r){return t(e)||o.apply(this,arguments)}function u(e,t,o){function u(e){var t=(l[e]||"silent").toUpperCase();if(("undefined"==typeof window?"undefined":s(window))!==c){try{return void(window.localStorage[d]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(d)+"="+t+";"}catch(e){}}}function a(){var e;if(("undefined"==typeof window?"undefined":s(window))!==c){try{e=window.localStorage[d]}catch(e){}if(("undefined"==typeof e?"undefined":s(e))===c)try{var t=window.document.cookie,n=t.indexOf(encodeURIComponent(d)+"=");n!==-1&&(e=/^([^;]+)/.exec(t.slice(n))[1])}catch(e){}return void 0===p.levels[e]&&(e=void 0),e}}var f,p=this,d="loglevel";e&&(d+=":"+e),p.name=e,p.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},p.methodFactory=o||i,p.getLevel=function(){return f},p.setLevel=function(t,o){if("string"==typeof t&&void 0!==p.levels[t.toUpperCase()]&&(t=p.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=p.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(f=t,o!==!1&&u(t),r.call(p,t,e),("undefined"==typeof n?"undefined":s(n))===c&&t<p.levels.SILENT)return"No console available for logging"},p.setDefaultLevel=function(e){a()||p.setLevel(e,!1)},p.enableAll=function(e){p.setLevel(p.levels.TRACE,e)},p.disableAll=function(e){p.setLevel(p.levels.SILENT,e)};var h=a();null==h&&(h=null==t?"WARN":t),p.setLevel(h,!1)}var a=function(){},c="undefined",l=["trace","debug","info","warn","error"],f=new u,p={};f.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=p[e];return t||(t=p[e]=new u(e,f.getLevel(),f.methodFactory)),t};var d=("undefined"==typeof window?"undefined":s(window))!==c?window.log:void 0;return f.noConflict=function(){return("undefined"==typeof window?"undefined":s(window))!==c&&window.log===f&&(window.log=d),f},f.getLoggers=function(){return p},f})}),H=Object.prototype.toString,J=function(e){switch(H.call(e)){case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object Error]":return"error"}return null===e?"null":void 0===e?"undefined":e!==e?"nan":e&&1===e.nodeType?"element":(e=e.valueOf?e.valueOf():Object.prototype.valueOf.apply(e),"undefined"==typeof e?"undefined":s(e))},Y=Object.prototype.toString,Z=function(e){var t;return"[object Object]"===Y.call(e)&&(t=Object.getPrototypeOf(e),null===t||t===Object.getPrototypeOf({}))},Q=r(function(e,t){function n(e){return e&&e.__esModule?e:{default:e}}function r(e){var t=W.IDBKeyRange||W.webkitIDBKeyRange;if(e instanceof t)return e;if("undefined"==typeof e||null===e)return null;if(!(0,o.default)(e))return t.only(e);var n=Object.keys(e).sort();if(1===n.length){var r=n[0],i=e[r];switch(r){case"eq":return t.only(i);case"gt":return t.lowerBound(i,!0);case"lt":return t.upperBound(i,!0);case"gte":return t.lowerBound(i);case"lte":return t.upperBound(i);default:throw new TypeError('"'+r+'" is not valid key')}}else{var u=e[n[0]],s=e[n[1]],a=n.join("-");switch(a){case"gt-lt":return t.bound(u,s,!0,!0);case"gt-lte":return t.bound(u,s,!0,!1);case"gte-lt":return t.bound(u,s,!1,!0);case"gte-lte":return t.bound(u,s,!1,!1);default:throw new TypeError('"'+a+'" are conflicted keys')}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var o=n(Z);e.exports=t.default});t(Q);var X=o;o.prototype.index=function(e){return this.indexes[e]},o.prototype.put=function(e,t,n){var r=this.name,o=this.key;o&&("object"==J(e)?(n=t,t=e,e=null):t[o]=e),this.db.transaction("readwrite",[r],function(i,u){if(i)return n(i);var s=u.objectStore(r),a=o?s.put(t):s.put(t,e);u.onerror=u.onabort=a.onerror=n,u.oncomplete=function(){n(null,a.result)}})},o.prototype.get=function(e,t){var n=this.name;this.db.transaction("readonly",[n],function(r,o){if(r)return t(r);var i=o.objectStore(n),u=i.get(e);u.onerror=t,u.onsuccess=function(e){t(null,e.target.result)}})},o.prototype.del=function(e,t){var n=this.name;this.db.transaction("readwrite",[n],function(r,o){if(r)return t(r);var i=o.objectStore(n),u=i.delete(e);o.onerror=o.onabort=u.onerror=t,o.oncomplete=function(){t()}})},o.prototype.count=function(e){var t=this.name;this.db.transaction("readonly",[t],function(n,r){if(n)return e(n);var o=r.objectStore(t),i=o.count();i.onerror=e,i.onsuccess=function(t){e(null,t.target.result)}})},o.prototype.clear=function(e){var t=this.name;this.db.transaction("readwrite",[t],function(n,r){if(n)return e(n);var o=r.objectStore(t),i=o.clear();r.onerror=r.onabort=i.onerror=e,r.oncomplete=function(){e()}})},o.prototype.batch=function(e,t){var n=this.name,r=this.key,o=Object.keys(e);this.db.transaction("readwrite",[n],function(i,u){function s(){if(!(c>=o.length)){var n,i=o[c],u=e[i];null===u?n=a.delete(i):r?(u[r]||(u[r]=i),n=a.put(u)):n=a.put(u,i),n.onerror=t,n.onsuccess=s,c+=1}}if(i)return t(i);var a=u.objectStore(n),c=0;u.onerror=u.onabort=t,u.oncomplete=function(){t()},s()})},o.prototype.all=function(e){function t(e){n.push(e.value),e.continue()}var n=[];this.cursor({iterator:t},function(t){t?e(t):e(null,n)})},o.prototype.cursor=function(e,t){var n=this.name;this.db.transaction("readonly",[n],function(r,o){if(r)return t(r);var i=e.index?o.objectStore(n).index(e.index):o.objectStore(n),u=i.openCursor(Q(e.range));u.onerror=t,u.onsuccess=function(n){var r=n.target.result;r?e.iterator(r):t()}})};var ee=i;i.prototype.get=function(e,t){function n(e){r.push(e.value),e.continue()}var r=[],o=this.unique,i={range:e,iterator:n};this.cursor(i,function(e){return e?t(e):void(o?t(null,r[0]):t(null,r))})},i.prototype.count=function(e,t){var n=this.store.name,r=this.name;this.store.db.transaction("readonly",[n],function(o,i){if(o)return t(o);var u=i.objectStore(n).index(r),s=u.count(Q(e));s.onerror=t,s.onsuccess=function(e){t(null,e.target.result)}})},i.prototype.cursor=function(e,t){e.index=this.name,this.store.cursor(e,t)};var te=a;a.prototype.version=function(e){if("number"!=J(e)||e<1||e<this.getVersion())throw new TypeError("not valid version");return this._current={version:e,store:null},this._versions[e]={stores:[],dropStores:[],indexes:[],dropIndexes:[],version:e},this},a.prototype.addStore=function(e,t){if("string"!=J(e))throw new TypeError("`name` is required");if(this._stores[e])throw new TypeError("store is already defined");var n=new X(e,t||{});return this._stores[e]=n,this._versions[this.getVersion()].stores.push(n),this._current.store=n,this},a.prototype.dropStore=function(e){if("string"!=J(e))throw new TypeError("`name` is required");var t=this._stores[e];if(!t)throw new TypeError("store is not defined");return delete this._stores[e],this._versions[this.getVersion()].dropStores.push(t),this},a.prototype.addIndex=function(e,t,n){if("string"!=J(e))throw new TypeError("`name` is required");if("string"!=J(t)&&"array"!=J(t))throw new TypeError("`field` is required");var r=this._current.store;if(r.indexes[e])throw new TypeError("index is already defined");var o=new ee(r,e,t,n||{});return r.indexes[e]=o,this._versions[this.getVersion()].indexes.push(o),this},a.prototype.dropIndex=function(e){if("string"!=J(e))throw new TypeError("`name` is required");var t=this._current.store.indexes[e];if(!t)throw new TypeError("index is not defined");return delete this._current.store.indexes[e],this._versions[this.getVersion()].dropIndexes.push(t),this},a.prototype.getStore=function(e){if("string"!=J(e))throw new TypeError("`name` is required");if(!this._stores[e])throw new TypeError("store is not defined");return this._current.store=this._stores[e],this},a.prototype.getVersion=function(){return this._current.version},a.prototype.callback=function(){var e=Object.keys(this._versions).map(function(e){return this._versions[e]},this).sort(function(e,t){return e.version-t.version});return function(t){var n=t.target.result,r=t.target.transaction;e.forEach(function(e){t.oldVersion>=e.version||(e.stores.forEach(function(e){var t={};"undefined"!=typeof e.key&&(t.keyPath=e.key),"undefined"!=typeof e.increment&&(t.autoIncrement=e.increment),n.createObjectStore(e.name,t)}),e.dropStores.forEach(function(e){n.deleteObjectStore(e.name)}),e.indexes.forEach(function(e){var t=r.objectStore(e.store.name);t.createIndex(e.name,e.field,{unique:e.unique,multiEntry:e.multi})}),e.dropIndexes.forEach(function(e){var t=r.objectStore(e.store.name);t.deleteIndex(e.name)}))})}};var ne=r(function(e,t){function n(e,t){if(!(this instanceof n))return new n(e,t);if("string"!=J(e))throw new TypeError("`name` required");if(!(t instanceof te))throw new TypeError("not valid schema");this.name=e,this.status="close",this.origin=null,this.stores=t._stores,this.version=t.getVersion(),this.onupgradeneeded=t.callback(),Object.keys(this.stores).forEach(function(e){this.stores[e].db=this},this)}function r(){return o().cmp.apply(o(),arguments)}function o(){return W._indexedDB||W.indexedDB||W.msIndexedDB||W.mozIndexedDB||W.webkitIndexedDB}t=e.exports=n,t.schema=te,t.cmp=r,t.Treo=n,t.Schema=te,t.Store=X,t.Index=ee,n.prototype.use=function(e){return e(this,t),this},n.prototype.drop=function(e){var t=this.name;this.close(function(n){if(n)return e(n);var r=o().deleteDatabase(t);r.onerror=e,r.onsuccess=function(){e()}})},n.prototype.close=function(e){return"close"==this.status?e():void this.getInstance(function(t,n){return t?e(t):(n.origin=null,n.status="close",n.close(),void e())})},n.prototype.store=function(e){return this.stores[e]},n.prototype.getInstance=function(e){if("open"==this.status)return e(null,this.origin);if("opening"==this.status)return this.queue.push(e);this.status="opening",this.queue=[e];var t=this,n=o().open(this.name,this.version);n.onupgradeneeded=this.onupgradeneeded,n.onerror=n.onblocked=function(e){t.status="error",t.queue.forEach(function(t){t(e)}),delete t.queue},n.onsuccess=function(e){t.origin=e.target.result,t.status="open",t.origin.onversionchange=function(){t.close(function(){})},t.queue.forEach(function(e){e(null,t.origin)}),delete t.queue}},n.prototype.transaction=function(e,t,n){this.getInstance(function(r,o){r?n(r):n(null,o.transaction(t,e))})}}),re=(ne.schema,ne.cmp,ne.Treo,ne.Schema,ne.Store,ne.Index,$.getLogger("RSStorage:operations"));re.setLevel("warn");var oe=["_email.id","_email.tid"],ie=[[{name:"_id.list",indexes:["sift.guid"]},{name:"_tid.list",indexes:["sift.guid"]}],[{name:"_email.id",indexes:["sift.guid"]},{name:"_email.tid",indexes:["sift.guid"]},{name:"_id.list",drop:!0},{name:"_tid.list",drop:!0}]],ue=[{name:"events",indexes:["value.sift.guid"]},{name:"admin"}],se=[{name:"tour"},{name:"spm"},{name:"auth"}],ae=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},ce=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),le=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},fe=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t},pe=new WeakMap,de=new WeakMap,he=function(){function e(t,n){if(ae(this,e),this._logger=$.getLogger("RSStorage"),this._logger.setLevel(n||"warn"),!t.accountGuid)throw new Error("[Storage]: dbInfo.accountGuid undefined");pe.set(this,t.siftGuid),de.set(this,c(t))}return ce(e,[{key:"get",value:function(e){return this._logger.trace("[Storage::get]: ",e),d(de.get(this),e,pe.get(this))}},{key:"getAll",value:function(e){return this._logger.trace("[Storage::getAll]: ",e),h(de.get(this),e,pe.get(this))}},{key:"getAllKeys",value:function(e){return this._logger.trace("[Storage::getAllKeys]: ",e),g(de.get(this),e,pe.get(this))}},{key:"getIndex",value:function(e){return this._logger.trace("[Storage::getIndex]: ",e),y(de.get(this),e,pe.get(this))}},{key:"getIndexKeys",value:function(e){return this._logger.trace("[Storage::getIndexKeys]: ",e),v(de.get(this),e,pe.get(this))}},{key:"getWithIndex",value:function(e){return this._logger.trace("[Storage::getWithIndex]: ",e),b(de.get(this),e,pe.get(this))}},{key:"delUser",value:function(e){return e.bucket="_user.default",this._logger.trace("[Storage::delUser]: ",e),p(de.get(this),e,pe.get(this))}},{key:"getUser",
value:function(e){return e.bucket="_user.default",this._logger.trace("[Storage::getUser]: ",e),d(de.get(this),e,pe.get(this))}},{key:"putUser",value:function(e){return e.bucket="_user.default",this._logger.trace("[Storage::putUser]: ",e),e.kvs&&0!==e.kvs.length?m(de.get(this),e,!1,pe.get(this)):Promise.reject("[Storage::putUser]: params.kvs undefined")}},{key:"close",value:function(e){k(de.get(this),e)}}]),e}(),ge=(function(e){function t(e,n){return ae(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return le(t,e),ce(t,[{key:"get",value:function(e,t){return this._logger.trace("[InternalStorage::get]: ",e,t),d(de.get(this),e,t||pe.get(this))}},{key:"getAll",value:function(e,t){return this._logger.trace("[InternalStorage::getAll]: ",e,t),h(de.get(this),e,t||pe.get(this))}},{key:"getAllKeys",value:function(e,t){return this._logger.trace("[InternalStorage::getAllKeys]: ",e,t),g(de.get(this),e,t||pe.get(this))}},{key:"getIndex",value:function(e,t){return this._logger.trace("[InternalStorage::getIndex]: ",e,t),y(de.get(this),e,t||pe.get(this))}},{key:"getIndexKeys",value:function(e,t){return this._logger.trace("[InternalStorage::getIndexKeys]: ",e,t),v(de.get(this),e,t||pe.get(this))}},{key:"getWithIndex",value:function(e,t){return this._logger.trace("[InternalStorage::getWithIndex]: ",e,t),b(de.get(this),e,t||pe.get(this))}},{key:"cursor",value:function(e,t){this._logger.trace("[InternalStorage::cursor]: ",e),l(de.get(this).db,e,t)}},{key:"del",value:function(e,t){return this._logger.trace("[InternalStorage::del]: ",e,t),p(de.get(this),e,t||pe.get(this))}},{key:"deleteDatabase",value:function(){return this._logger.trace("[InternalStorage::deleteDatabase]"),f(de.get(this).db)}},{key:"getDbs",value:function(){return de.get(this)}},{key:"put",value:function(e,t,n){return this._logger.trace("[InternalStorage::put]: ",e,t,n),m(de.get(this),e,t,n||pe.get(this))}}]),t}(he),function(){function e(){G(this,e),this._proxy=self,this.view=new B,this.emailclient=new K(self),this._registerMessageListeners()}return U(e,[{key:"publish",value:function(e,t){this._proxy.postMessage({method:"notifyView",params:{topic:e,value:t}})}},{key:"_registerMessageListeners",value:function(){var e=this;this._proxy&&(this._proxy.onmessage=function(t){var n=t.data.method;e["_"+n]&&e["_"+n](t.data.params)})}},{key:"_init",value:function(e){this.storage=new F,this.storage.init(new he({type:"SIFT",siftGuid:e.siftGuid,accountGuid:e.accountGuid,schema:e.dbSchema})),this._guid=e.siftGuid,this._account=e.accountGuid,this._proxy.postMessage({method:"initCallback",result:e})}},{key:"_terminate",value:function(){this._proxy&&this._proxy.close()}},{key:"_postCallback",value:function(e,t){this._proxy.postMessage({method:"loadViewCallback",params:{user:{guid:this._account},sift:{guid:this._guid},type:e.type,sizeClass:e.sizeClass,result:t}})}},{key:"_loadView",value:function(e){var t=this;if(!this.loadView)return void n.error("[SiftController::_loadView]: Sift controller must implement the loadView method");var r=this.loadView({sizeClass:e.sizeClass,type:e.type,params:e.data});r.data&&"function"==typeof r.data.then?(r.html&&this._postCallback(e,{html:r.html}),r.data.then(function(n){t._postCallback(e,{html:r.html,data:n})}).catch(function(e){n.error("[SiftController::loadView]: promise rejected: ",e)})):this._postCallback(e,r)}},{key:"_storageUpdated",value:function(e){var t=this;this.storage.publish("*",e),e.forEach(function(e){t.storage.publish(e,[e])})}},{key:"_notifyController",value:function(e){this.view.publish(e.topic,e.value)}},{key:"_emailComposer",value:function(e){this.emailclient.publish(e.topic,e.value)}}]),e}());e.EmailClientController=M,e.SiftController=ge,e.SiftStorage=F,e.SiftView=N,e.registerSiftView=j,e.createSiftView=T,e.createSiftController=C,e.registerSiftController=P,e.createEmailClientController=A,e.registerEmailClientController=D,Object.defineProperty(e,"__esModule",{value:!0})})}).call(t,n(1),function(){return this}())}]);
//# sourceMappingURL=view.umd-es2015.min.js.map